<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Vocal Vent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .sidebar {
            width: 250px;
            transition: transform 0.3s ease;
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                height: 100vh;
                z-index: 40;
            }
            .sidebar.open {
                transform: translateX(0);
            }
        }
        .stat-card {
            transition: transform 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .nav-link.active {
            background-color: #4f46e5;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Admin Navigation -->
    <div class="flex">
        <!-- Sidebar -->
        <div class="sidebar bg-gray-900 text-white min-h-screen">
            <div class="p-6">
                <div class="flex items-center mb-8">
                    <i class="fas fa-microphone-alt text-2xl text-purple-400 mr-3"></i>
                    <h1 class="text-xl font-bold">Vocal Vent Admin</h1>
                </div>
                
                <nav class="space-y-2">
                    <a href="#" class="nav-link block p-3 rounded-lg hover:bg-gray-800 transition duration-300 active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt mr-3"></i> Dashboard
                    </a>
                    <a href="#" class="nav-link block p-3 rounded-lg hover:bg-gray-800 transition duration-300" data-section="bookings">
                        <i class="fas fa-calendar-alt mr-3"></i> Bookings
                    </a>
                    <a href="#" class="nav-link block p-3 rounded-lg hover:bg-gray-800 transition duration-300" data-section="chat-sessions">
                        <i class="fas fa-comments mr-3"></i> Chat Sessions
                    </a>
                    <a href="#" class="nav-link block p-3 rounded-lg hover:bg-gray-800 transition duration-300" data-section="corporate">
                        <i class="fas fa-building mr-3"></i> Corporate Clients
                    </a>
                    <a href="#" class="nav-link block p-3 rounded-lg hover:bg-gray-800 transition duration-300" data-section="settings">
                        <i class="fas fa-cog mr-3"></i> Settings
                    </a>
                    <a href="#" class="nav-link block p-3 rounded-lg hover:bg-gray-800 transition duration-300" data-section="reports">
                        <i class="fas fa-chart-bar mr-3"></i> Reports
                    </a>
                </nav>
                
                <div class="mt-12 pt-6 border-t border-gray-800">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div>
                            <p class="font-bold">Admin User</p>
                            <p class="text-sm text-gray-400">Super Admin</p>
                        </div>
                    </div>
                    <button onclick="logout()" class="w-full mt-4 p-3 text-left rounded-lg hover:bg-gray-800 transition duration-300">
                        <i class="fas fa-sign-out-alt mr-3"></i> Logout
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1">
            <!-- Top Bar -->
            <div class="bg-white shadow">
                <div class="flex justify-between items-center p-4">
                    <button id="menuToggle" class="md:hidden text-2xl text-gray-700">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="flex-1 text-right">
                        <span class="text-gray-600">Last updated: <span id="lastUpdated"></span></span>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="p-6">
                <!-- Dashboard Section -->
                <div id="dashboard" class="admin-section">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">Dashboard Overview</h2>
                    
                    <!-- Statistics Cards -->
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="stat-card bg-white rounded-xl shadow p-6">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-500 text-sm">Total Bookings</p>
                                    <p class="text-3xl font-bold" id="totalBookings">0</p>
                                </div>
                                <div class="text-blue-500 text-2xl">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                            </div>
                            <div class="mt-4 text-sm text-green-600">
                                <i class="fas fa-arrow-up mr-1"></i> 12% from last month
                            </div>
                        </div>
                        
                        <div class="stat-card bg-white rounded-xl shadow p-6">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-500 text-sm">Active Chats</p>
                                    <p class="text-3xl font-bold" id="activeChats">0</p>
                                </div>
                                <div class="text-green-500 text-2xl">
                                    <i class="fas fa-comments"></i>
                                </div>
                            </div>
                            <div class="mt-4 text-sm text-blue-600">
                                <i class="fas fa-users mr-1"></i> 5 listeners online
                            </div>
                        </div>
                        
                        <div class="stat-card bg-white rounded-xl shadow p-6">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-500 text-sm">Corporate Clients</p>
                                    <p class="text-3xl font-bold" id="corporateClients">0</p>
                                </div>
                                <div class="text-purple-500 text-2xl">
                                    <i class="fas fa-building"></i>
                                </div>
                            </div>
                            <div class="mt-4 text-sm text-yellow-600">
                                <i class="fas fa-clock mr-1"></i> 3 pending requests
                            </div>
                        </div>
                        
                        <div class="stat-card bg-white rounded-xl shadow p-6">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-500 text-sm">Revenue Today</p>
                                    <p class="text-3xl font-bold" id="revenueToday">KSH 0</p>
                                </div>
                                <div class="text-yellow-500 text-2xl">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                            </div>
                            <div class="mt-4 text-sm text-green-600">
                                <i class="fas fa-arrow-up mr-1"></i> 8% from yesterday
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold mb-4">Recent Bookings</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b">
                                            <th class="text-left py-2 text-gray-600">Nickname</th>
                                            <th class="text-left py-2 text-gray-600">Package</th>
                                            <th class="text-left py-2 text-gray-600">Status</th>
                                            <th class="text-left py-2 text-gray-600">Time</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentBookings">
                                        <!-- Will be filled by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold mb-4">System Status</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span>Payd Money API</span>
                                    <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">Connected</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span>Database</span>
                                    <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">Online</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span>Chat Service</span>
                                    <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">Running</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span>Email Notifications</span>
                                    <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm">Pending</span>
                                </div>
                            </div>
                            
                            <div class="mt-8">
                                <h4 class="font-bold mb-3">Quick Actions</h4>
                                <div class="grid grid-cols-2 gap-3">
                                    <button onclick="showSection('settings')" class="bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 transition duration-300">
                                        <i class="fas fa-phone mr-2"></i> Update Contacts
                                    </button>
                                    <button onclick="showSection('reports')" class="bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 transition duration-300">
                                        <i class="fas fa-download mr-2"></i> Export Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bookings Section -->
                <div id="bookings" class="admin-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Manage Bookings</h2>
                        <button onclick="exportBookings()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-300">
                            <i class="fas fa-download mr-2"></i> Export
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow overflow-hidden">
                        <div class="p-4 border-b">
                            <div class="flex flex-wrap gap-4">
                                <input type="text" id="searchBookings" placeholder="Search bookings..." 
                                       class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <select id="filterStatus" class="px-4 py-2 border rounded-lg">
                                    <option value="">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="confirmed">Confirmed</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                                <input type="date" id="filterDate" class="px-4 py-2 border rounded-lg">
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="py-3 px-4 text-left">ID</th>
                                        <th class="py-3 px-4 text-left">Nickname</th>
                                        <th class="py-3 px-4 text-left">Package</th>
                                        <th class="py-3 px-4 text-left">Date & Time</th>
                                        <th class="py-3 px-4 text-left">Phone</th>
                                        <th class="py-3 px-4 text-left">Status</th>
                                        <th class="py-3 px-4 text-left">Amount</th>
                                        <th class="py-3 px-4 text-left">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="bookingsTable">
                                    <!-- Will be filled by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="p-4 border-t flex justify-between items-center">
                            <div class="text-gray-600" id="bookingsCount">Showing 0 bookings</div>
                            <div class="flex gap-2">
                                <button onclick="prevBookingsPage()" class="px-3 py-1 border rounded disabled:opacity-50">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span id="bookingsPageInfo">Page 1</span>
                                <button onclick="nextBookingsPage()" class="px-3 py-1 border rounded disabled:opacity-50">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Sessions Section -->
                <div id="chat-sessions" class="admin-section hidden">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">Chat Sessions</h2>
                    
                    <div class="grid md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="font-bold mb-4">Active Sessions</h3>
                            <div class="space-y-3" id="activeSessionsList">
                                <!-- Will be filled by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow p-6 md:col-span-2">
                            <h3 class="font-bold mb-4">Chat Platform Statistics</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                <div class="text-center p-4 bg-blue-50 rounded-lg">
                                    <div class="text-2xl font-bold" id="whatsappCount">0</div>
                                    <div class="text-sm text-blue-600">WhatsApp</div>
                                </div>
                                <div class="text-center p-4 bg-purple-50 rounded-lg">
                                    <div class="text-2xl font-bold" id="inappCount">0</div>
                                    <div class="text-sm text-purple-600">In-App</div>
                                </div>
                                <div class="text-center p-4 bg-green-50 rounded-lg">
                                    <div class="text-2xl font-bold" id="smsCount">0</div>
                                    <div class="text-sm text-green-600">SMS</div>
                                </div>
                                <div class="text-center p-4 bg-pink-50 rounded-lg">
                                    <div class="text-2xl font-bold" id="instagramCount">0</div>
                                    <div class="text-sm text-pink-600">Instagram</div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-bold mb-3">Recent Sessions</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead>
                                            <tr class="border-b">
                                                <th class="py-2 text-left">Platform</th>
                                                <th class="py-2 text-left">Duration</th>
                                                <th class="py-2 text-left">Nickname</th>
                                                <th class="py-2 text-left">Time</th>
                                                <th class="py-2 text-left">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="chatSessionsTable">
                                            <!-- Will be filled by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Corporate Clients Section -->
                <div id="corporate" class="admin-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Corporate Clients</h2>
                        <button onclick="addCorporateClient()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-300">
                            <i class="fas fa-plus mr-2"></i> Add Client
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow overflow-hidden mb-8">
                        <div class="p-4 border-b">
                            <h3 class="font-bold">Client Management</h3>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="py-3 px-4 text-left">Corporate ID</th>
                                        <th class="py-3 px-4 text-left">Institution</th>
                                        <th class="py-3 px-4 text-left">Contact</th>
                                        <th class="py-3 px-4 text-left">Members</th>
                                        <th class="py-3 px-4 text-left">Status</th>
                                        <th class="py-3 px-4 text-left">Subscription</th>
                                        <th class="py-3 px-4 text-left">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="corporateTable">
                                    <!-- Will be filled by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Add Corporate Member Form -->
                    <div id="addMemberForm" class="bg-white rounded-xl shadow p-6 hidden">
                        <h3 class="text-lg font-bold mb-4">Add Corporate Member</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 mb-2">Corporate ID</label>
                                <input type="text" id="memberCorporateId" 
                                       class="w-full px-4 py-2 border rounded-lg" 
                                       placeholder="Enter corporate ID">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Employee ID</label>
                                <input type="text" id="employeeId" 
                                       class="w-full px-4 py-2 border rounded-lg" 
                                       placeholder="Enter employee ID">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 mb-2">Access Code</label>
                                <input type="text" id="accessCode" 
                                       class="w-full px-4 py-2 border rounded-lg" 
                                       value="VV" + Date.now().toString().substring(8) 
                                       readonly>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end gap-3">
                            <button onclick="cancelAddMember()" class="px-4 py-2 border rounded-lg">Cancel</button>
                            <button onclick="saveMember()" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Save Member</button>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings" class="admin-section hidden">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">Settings</h2>
                    
                    <div class="grid lg:grid-cols-2 gap-8">
                        <!-- Contact Settings -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold mb-4">Contact Information</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 mb-2">Contact Line 1</label>
                                    <input type="text" id="contactLine1" 
                                           class="w-full px-4 py-2 border rounded-lg" 
                                           value="+254 700 000 001">
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">Contact Line 2</label>
                                    <input type="text" id="contactLine2" 
                                           class="w-full px-4 py-2 border rounded-lg" 
                                           value="+254 700 000 002">
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">WhatsApp Number</label>
                                    <input type="text" id="whatsappNumber" 
                                           class="w-full px-4 py-2 border rounded-lg" 
                                           value="+254 700 000 003">
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">Instagram Handle</label>
                                    <input type="text" id="instagramHandle" 
                                           class="w-full px-4 py-2 border rounded-lg" 
                                           value="@vocalvent">
                                </div>
                                <button onclick="saveContactSettings()" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700">
                                    Save Contact Settings
                                </button>
                            </div>
                        </div>
                        
                        <!-- Payment Settings -->
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-bold mb-4">Payment Settings</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 mb-2">Payd Money Username</label>
                                    <input type="text" id="paydUsername" 
                                           class="w-full px-4 py-2 border rounded-lg" 
                                           value="S9uy63diFWNRnkjHGiXw">
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">API Secret</label>
                                    <input type="password" id="paydSecret" 
                                           class="w-full px-4 py-2 border rounded-lg" 
                                           value="Wc6OdqaoR2c2qMWa3kgWzKqQ9QJRYRHNhNVuwg5C">
                                </div>
                                <div class="text-sm text-gray-600">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    These credentials are for demonstration only. In production, use environment variables.
                                </div>
                                <button onclick="testPaymentConnection()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                                    Test Payment Connection
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Package Pricing -->
                    <div class="bg-white rounded-xl shadow p-6 mt-8">
                        <h3 class="text-lg font-bold mb-4">Package Pricing</h3>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-gray-700 mb-2">MINI Space (10 min)</label>
                                <input type="number" id="priceMini" 
                                       class="w-full px-4 py-2 border rounded-lg" 
                                       value="200">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">LITE Space (20 min)</label>
                                <input type="number" id="priceLite" 
                                       class="w-full px-4 py-2 border rounded-lg" 
                                       value="400">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">V.I.P Space (2 hr)</label>
                                <input type="number" id="priceVip" 
                                       class="w-full px-4 py-2 border rounded-lg" 
                                       value="1000">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">EXPRESS LINE (30 min)</label>
                                <input type="number" id="priceExpress" 
                                       class="w-full px-4 py-2 border rounded-lg" 
                                       value="500">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Chat 30 min</label>
                                <input type="number" id="priceChat30" 
                                       class="w-full px-4 py-2 border rounded-lg" 
                                       value="300">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Chat 1 hr</label>
                                <input type="number" id="priceChat60" 
                                       class="w-full px-4 py-2 border rounded-lg" 
                                       value="500">
                            </div>
                        </div>
                        <button onclick="savePackagePricing()" class="mt-6 w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">
                            Save Pricing
                        </button>
                    </div>
                </div>

                <!-- Reports Section -->
                <div id="reports" class="admin-section hidden">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">Reports & Analytics</h2>
                    
                    <div class="grid md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="font-bold mb-4">Date Range</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-700 mb-2">From</label>
                                    <input type="date" id="reportFrom" class="w-full px-4 py-2 border rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">To</label>
                                    <input type="date" id="reportTo" class="w-full px-4 py-2 border rounded-lg">
                                </div>
                            </div>
                            <button onclick="generateReport()" class="w-full mt-4 bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700">
                                Generate Report
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow p-6">
                            <h3 class="font-bold mb-4">Report Type</h3>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="radio" name="reportType" value="bookings" class="mr-2" checked>
                                    <span>Booking Analysis</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="reportType" value="revenue" class="mr-2">
                                    <span>Revenue Report</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="reportType" value="chats" class="mr-2">
                                    <span>Chat Session Analysis</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="reportType" value="corporate" class="mr-2">
                                    <span>Corporate Clients Report</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div id="reportResults" class="bg-white rounded-xl shadow p-6 hidden">
                        <h3 class="font-bold mb-4">Report Results</h3>
                        <div id="reportContent">
                            <!-- Report content will be generated here -->
                        </div>
                        <div class="mt-6 flex gap-3">
                            <button onclick="printReport()" class="px-4 py-2 bg-blue-600 text-white rounded-lg">
                                <i class="fas fa-print mr-2"></i> Print
                            </button>
                            <button onclick="exportReport()" class="px-4 py-2 bg-green-600 text-white rounded-lg">
                                <i class="fas fa-file-excel mr-2"></i> Export as CSV
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="editBookingModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <h3 class="text-xl font-bold mb-4">Edit Booking</h3>
                <div id="editBookingForm">
                    <!-- Form will be loaded here -->
                </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button onclick="closeEditBooking()" class="px-4 py-2 border rounded-lg">Cancel</button>
                    <button onclick="saveBooking()" class="px-4 py-2 bg-green-600 text-white rounded-lg">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Admin functionality
        let currentBookingPage = 1;
        const bookingsPerPage = 10;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateLastUpdated();
            loadDashboardData();
            setupEventListeners();
            
            // Check admin authentication
            const isAdmin = localStorage.getItem('adminLoggedIn');
            if (!isAdmin) {
                // In a real app, this would redirect to login
                alert('Please login as admin');
                // For demo purposes, set admin as logged in
                localStorage.setItem('adminLoggedIn', 'true');
            }
        });

        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('lastUpdated').textContent = 
                now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-section') === sectionId) {
                    link.classList.add('active');
                }
            });
            
            // Load section data
            switch(sectionId) {
                case 'bookings':
                    loadBookings();
                    break;
                case 'chat-sessions':
                    loadChatSessions();
                    break;
                case 'corporate':
                    loadCorporateClients();
                    break;
            }
        }

        // Event listeners
        function setupEventListeners() {
            // Navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);
                });
            });

            // Mobile menu toggle
            document.getElementById('menuToggle').addEventListener('click', function() {
                document.querySelector('.sidebar').classList.toggle('open');
            });

            // Search and filter bookings
            document.getElementById('searchBookings')?.addEventListener('input', loadBookings);
            document.getElementById('filterStatus')?.addEventListener('change', loadBookings);
            document.getElementById('filterDate')?.addEventListener('change', loadBookings);
        }

        // Dashboard data
        function loadDashboardData() {
            // Load bookings
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            document.getElementById('totalBookings').textContent = bookings.length;
            
            // Load recent bookings
            const recentBookings = bookings.slice(-5).reverse();
            const recentBookingsHtml = recentBookings.map(booking => `
                <tr class="border-b">
                    <td class="py-2">${booking.nickname || 'Anonymous'}</td>
                    <td class="py-2">${booking.package?.name || 'N/A'}</td>
                    <td class="py-2">
                        <span class="px-2 py-1 rounded-full text-xs 
                            ${booking.status === 'confirmed' ? 'bg-green-100 text-green-800' : 
                              booking.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 
                              'bg-gray-100 text-gray-800'}">
                            ${booking.status || 'pending'}
                        </span>
                    </td>
                    <td class="py-2">${booking.time || 'N/A'}</td>
                </tr>
            `).join('');
            document.getElementById('recentBookings').innerHTML = recentBookingsHtml || 
                '<tr><td colspan="4" class="py-4 text-center text-gray-500">No recent bookings</td></tr>';

            // Load chat sessions
            const chatSessions = JSON.parse(localStorage.getItem('chatSessions') || '[]');
            const activeChats = chatSessions.filter(session => !session.endTime).length;
            document.getElementById('activeChats').textContent = activeChats;

            // Load corporate clients
            const corporateRequests = JSON.parse(localStorage.getItem('corporateRequests') || '[]');
            document.getElementById('corporateClients').textContent = corporateRequests.length;

            // Calculate revenue (simplified)
            let revenue = 0;
            bookings.forEach(booking => {
                if (booking.package?.price) {
                    revenue += parseInt(booking.package.price);
                }
            });
            document.getElementById('revenueToday').textContent = `KSH ${revenue}`;
        }

        // Bookings management
        function loadBookings() {
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const searchTerm = document.getElementById('searchBookings')?.value.toLowerCase() || '';
            const filterStatus = document.getElementById('filterStatus')?.value || '';
            const filterDate = document.getElementById('filterDate')?.value || '';
            
            // Filter bookings
            let filteredBookings = bookings.filter(booking => {
                const matchesSearch = !searchTerm || 
                    (booking.nickname?.toLowerCase().includes(searchTerm)) ||
                    (booking.package?.name?.toLowerCase().includes(searchTerm));
                
                const matchesStatus = !filterStatus || 
                    (booking.status === filterStatus);
                
                const matchesDate = !filterDate || 
                    (booking.date === filterDate);
                
                return matchesSearch && matchesStatus && matchesDate;
            });
            
            // Pagination
            const totalPages = Math.ceil(filteredBookings.length / bookingsPerPage);
            const startIndex = (currentBookingPage - 1) * bookingsPerPage;
            const endIndex = startIndex + bookingsPerPage;
            const pageBookings = filteredBookings.slice(startIndex, endIndex);
            
            // Update table
            const bookingsHtml = pageBookings.map((booking, index) => `
                <tr class="${index % 2 === 0 ? 'bg-gray-50' : ''}">
                    <td class="py-3 px-4">${startIndex + index + 1}</td>
                    <td class="py-3 px-4">${booking.nickname || 'Anonymous'}</td>
                    <td class="py-3 px-4">${booking.package?.fullName || 'N/A'}</td>
                    <td class="py-3 px-4">${booking.date} ${booking.time}</td>
                    <td class="py-3 px-4">${booking.phone || 'N/A'}</td>
                    <td class="py-3 px-4">
                        <select class="status-select px-2 py-1 rounded border" data-id="${startIndex + index}">
                            <option value="pending" ${booking.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="confirmed" ${booking.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
                            <option value="completed" ${booking.status === 'completed' ? 'selected' : ''}>Completed</option>
                            <option value="cancelled" ${booking.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                        </select>
                    </td>
                    <td class="py-3 px-4">KSH ${booking.package?.price || '0'}</td>
                    <td class="py-3 px-4">
                        <button onclick="editBooking(${startIndex + index})" class="text-blue-600 hover:text-blue-800 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteBooking(${startIndex + index})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="8" class="py-4 text-center text-gray-500">No bookings found</td></tr>';
            
            document.getElementById('bookingsTable').innerHTML = bookingsHtml;
            document.getElementById('bookingsCount').textContent = `Showing ${pageBookings.length} of ${filteredBookings.length} bookings`;
            document.getElementById('bookingsPageInfo').textContent = `Page ${currentBookingPage} of ${totalPages || 1}`;
            
            // Add event listeners to status selects
            document.querySelectorAll('.status-select').forEach(select => {
                select.addEventListener('change', function() {
                    updateBookingStatus(this.dataset.id, this.value);
                });
            });
        }

        function updateBookingStatus(index, status) {
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            if (bookings[index]) {
                bookings[index].status = status;
                localStorage.setItem('bookings', JSON.stringify(bookings));
                loadBookings();
            }
        }

        function editBooking(index) {
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const booking = bookings[index];
            
            if (booking) {
                document.getElementById('editBookingForm').innerHTML = `
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Nickname</label>
                            <input type="text" id="editNickname" class="w-full px-4 py-2 border rounded-lg" value="${booking.nickname || ''}">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Date</label>
                            <input type="date" id="editDate" class="w-full px-4 py-2 border rounded-lg" value="${booking.date || ''}">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Time</label>
                            <input type="time" id="editTime" class="w-full px-4 py-2 border rounded-lg" value="${booking.time || ''}">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Phone</label>
                            <input type="text" id="editPhone" class="w-full px-4 py-2 border rounded-lg" value="${booking.phone || ''}">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Package</label>
                            <input type="text" class="w-full px-4 py-2 border rounded-lg bg-gray-100" value="${booking.package?.fullName || ''}" readonly>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Amount</label>
                            <input type="text" class="w-full px-4 py-2 border rounded-lg bg-gray-100" value="KSH ${booking.package?.price || '0'}" readonly>
                        </div>
                    </div>
                    <input type="hidden" id="editBookingIndex" value="${index}">
                `;
                
                document.getElementById('editBookingModal').classList.remove('hidden');
                document.getElementById('editBookingModal').classList.add('flex');
            }
        }

        function closeEditBooking() {
            document.getElementById('editBookingModal').classList.add('hidden');
            document.getElementById('editBookingModal').classList.remove('flex');
        }

        function saveBooking() {
            const index = document.getElementById('editBookingIndex').value;
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            
            if (bookings[index]) {
                bookings[index].nickname = document.getElementById('editNickname').value;
                bookings[index].date = document.getElementById('editDate').value;
                bookings[index].time = document.getElementById('editTime').value;
                bookings[index].phone = document.getElementById('editPhone').value;
                
                localStorage.setItem('bookings', JSON.stringify(bookings));
                closeEditBooking();
                loadBookings();
                loadDashboardData();
            }
        }

        function deleteBooking(index) {
            if (confirm('Are you sure you want to delete this booking?')) {
                const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
                bookings.splice(index, 1);
                localStorage.setItem('bookings', JSON.stringify(bookings));
                loadBookings();
                loadDashboardData();
            }
        }

        function prevBookingsPage() {
            if (currentBookingPage > 1) {
                currentBookingPage--;
                loadBookings();
            }
        }

        function nextBookingsPage() {
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const totalPages = Math.ceil(bookings.length / bookingsPerPage);
            if (currentBookingPage < totalPages) {
                currentBookingPage++;
                loadBookings();
            }
        }

        function exportBookings() {
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const csv = convertToCSV(bookings);
            downloadCSV(csv, 'vocal-vent-bookings.csv');
        }

        // Chat sessions management
        function loadChatSessions() {
            const sessions = JSON.parse(localStorage.getItem('chatSessions') || '[]');
            
            // Active sessions
            const activeSessions = sessions.filter(session => !session.endTime);
            document.getElementById('activeSessionsList').innerHTML = activeSessions.map(session => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div>
                        <div class="font-bold">${session.nickname || 'Anonymous'}</div>
                        <div class="text-sm text-gray-600">${session.platform}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm">${session.duration || 30} min</div>
                        <div class="text-xs text-gray-500">Active</div>
                    </div>
                </div>
            `).join('') || '<div class="text-center text-gray-500">No active sessions</div>';
            
            // Platform counts
            const platformCounts = {
                whatsapp: sessions.filter(s => s.platform === 'whatsapp').length,
                inapp: sessions.filter(s => s.platform === 'inapp').length,
                sms: sessions.filter(s => s.platform === 'sms').length,
                instagram: sessions.filter(s => s.platform === 'instagram').length
            };
            
            document.getElementById('whatsappCount').textContent = platformCounts.whatsapp;
            document.getElementById('inappCount').textContent = platformCounts.inapp;
            document.getElementById('smsCount').textContent = platformCounts.sms;
            document.getElementById('instagramCount').textContent = platformCounts.instagram;
            
            // Recent sessions table
            const recentSessions = sessions.slice(-10).reverse();
            document.getElementById('chatSessionsTable').innerHTML = recentSessions.map(session => `
                <tr class="border-b">
                    <td class="py-2">
                        <span class="px-2 py-1 rounded-full text-xs 
                            ${session.platform === 'whatsapp' ? 'bg-green-100 text-green-800' :
                              session.platform === 'inapp' ? 'bg-purple-100 text-purple-800' :
                              session.platform === 'sms' ? 'bg-blue-100 text-blue-800' :
                              'bg-pink-100 text-pink-800'}">
                            ${session.platform}
                        </span>
                    </td>
                    <td class="py-2">${session.duration || 30} min</td>
                    <td class="py-2">${session.nickname || 'Anonymous'}</td>
                    <td class="py-2">${new Date(session.startTime).toLocaleTimeString()}</td>
                    <td class="py-2">
                        ${session.endTime ? 
                          '<span class="px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-800">Completed</span>' :
                          '<span class="px-2 py-1 rounded-full text-xs bg-green-100 text-green-800">Active</span>'}
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="5" class="py-4 text-center text-gray-500">No sessions found</td></tr>';
        }

        // Corporate clients management
        function loadCorporateClients() {
            const clients = JSON.parse(localStorage.getItem('corporateRequests') || '[]');
            
            document.getElementById('corporateTable').innerHTML = clients.map((client, index) => `
                <tr class="${index % 2 === 0 ? 'bg-gray-50' : ''}">
                    <td class="py-3 px-4">CORP-${client.institutionName?.substring(0, 3).toUpperCase() || 'N/A'}-${index + 1000}</td>
                    <td class="py-3 px-4">${client.institutionName || 'N/A'}</td>
                    <td class="py-3 px-4">${client.representativeName || 'N/A'}</td>
                    <td class="py-3 px-4">${client.memberCount || 'N/A'}</td>
                    <td class="py-3 px-4">
                        <select class="corporate-status px-2 py-1 rounded border" data-index="${index}">
                            <option value="pending" ${client.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="contacted" ${client.status === 'contacted' ? 'selected' : ''}>Contacted</option>
                            <option value="active" ${client.status === 'active' ? 'selected' : ''}>Active</option>
                            <option value="inactive" ${client.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                        </select>
                    </td>
                    <td class="py-3 px-4">
                        <select class="corporate-subscription px-2 py-1 rounded border" data-index="${index}">
                            <option value="trial" ${client.subscription === 'trial' ? 'selected' : ''}>Trial</option>
                            <option value="monthly" ${client.subscription === 'monthly' ? 'selected' : ''}>Monthly</option>
                            <option value="quarterly" ${client.subscription === 'quarterly' ? 'selected' : ''}>Quarterly</option>
                            <option value="annual" ${client.subscription === 'annual' ? 'selected' : ''}>Annual</option>
                        </select>
                    </td>
                    <td class="py-3 px-4">
                        <button onclick="viewCorporateClient(${index})" class="text-blue-600 hover:text-blue-800 mr-2">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="sendEmailToClient(${index})" class="text-green-600 hover:text-green-800 mr-2">
                            <i class="fas fa-envelope"></i>
                        </button>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="7" class="py-4 text-center text-gray-500">No corporate clients found</td></tr>';
            
            // Add event listeners to status and subscription selects
            document.querySelectorAll('.corporate-status').forEach(select => {
                select.addEventListener('change', function() {
                    updateCorporateStatus(this.dataset.index, this.value);
                });
            });
            
            document.querySelectorAll('.corporate-subscription').forEach(select => {
                select.addEventListener('change', function() {
                    updateCorporateSubscription(this.dataset.index, this.value);
                });
            });
        }

        function updateCorporateStatus(index, status) {
            const clients = JSON.parse(localStorage.getItem('corporateRequests') || '[]');
            if (clients[index]) {
                clients[index].status = status;
                localStorage.setItem('corporateRequests', JSON.stringify(clients));
            }
        }

        function updateCorporateSubscription(index, subscription) {
            const clients = JSON.parse(localStorage.getItem('corporateRequests') || '[]');
            if (clients[index]) {
                clients[index].subscription = subscription;
                localStorage.setItem('corporateRequests', JSON.stringify(clients));
            }
        }

        function addCorporateClient() {
            document.getElementById('addMemberForm').classList.remove('hidden');
        }

        function cancelAddMember() {
            document.getElementById('addMemberForm').classList.add('hidden');
        }

        function saveMember() {
            // In a real app, this would save to a database
            alert('Member added successfully!');
            cancelAddMember();
        }

        function viewCorporateClient(index) {
            const clients = JSON.parse(localStorage.getItem('corporateRequests') || '[]');
            const client = clients[index];
            
            if (client) {
                alert(`Client Details:\n\nInstitution: ${client.institutionName}\nContact: ${client.representativeName}\nPhone: ${client.representativePhone}\nEmail: ${client.representativeEmail}\nMembers: ${client.memberCount}`);
            }
        }

        function sendEmailToClient(index) {
            const clients = JSON.parse(localStorage.getItem('corporateRequests') || '[]');
            const client = clients[index];
            
            if (client) {
                const email = client.representativeEmail;
                const subject = encodeURIComponent('Vocal Vent Corporate Services');
                const body = encodeURIComponent(`Dear ${client.representativeName},\n\nThank you for your interest in Vocal Vent Corporate services...`);
                window.open(`mailto:${email}?subject=${subject}&body=${body}`);
            }
        }

        // Settings management
        function saveContactSettings() {
            const settings = {
                contactLine1: document.getElementById('contactLine1').value,
                contactLine2: document.getElementById('contactLine2').value,
                whatsappNumber: document.getElementById('whatsappNumber').value,
                instagramHandle: document.getElementById('instagramHandle').value
            };
            
            localStorage.setItem('contactSettings', JSON.stringify(settings));
            alert('Contact settings saved!');
        }

        function savePackagePricing() {
            const pricing = {
                mini: document.getElementById('priceMini').value,
                lite: document.getElementById('priceLite').value,
                vip: document.getElementById('priceVip').value,
                express: document.getElementById('priceExpress').value,
                chat30: document.getElementById('priceChat30').value,
                chat60: document.getElementById('priceChat60').value
            };
            
            localStorage.setItem('packagePricing', JSON.stringify(pricing));
            alert('Package pricing saved!');
        }

        function testPaymentConnection() {
            // Simulate payment connection test
            setTimeout(() => {
                alert('Payment connection test successful!');
            }, 1000);
        }

        // Reports
        function generateReport() {
            const fromDate = document.getElementById('reportFrom').value;
            const toDate = document.getElementById('reportTo').value;
            const reportType = document.querySelector('input[name="reportType"]:checked').value;
            
            let reportContent = '';
            
            switch(reportType) {
                case 'bookings':
                    const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
                    reportContent = `
                        <h4 class="font-bold mb-3">Booking Analysis Report</h4>
                        <p>Period: ${fromDate} to ${toDate}</p>
                        <p>Total Bookings: ${bookings.length}</p>
                        <p>Total Revenue: KSH ${bookings.reduce((sum, b) => sum + (parseInt(b.package?.price) || 0), 0)}</p>
                    `;
                    break;
                    
                case 'revenue':
                    const allBookings = JSON.parse(localStorage.getItem('bookings') || '[]');
                    const totalRevenue = allBookings.reduce((sum, b) => sum + (parseInt(b.package?.price) || 0), 0);
                    reportContent = `
                        <h4 class="font-bold mb-3">Revenue Report</h4>
                        <p>Total Revenue: KSH ${totalRevenue}</p>
                        <p>Average per booking: KSH ${Math.round(totalRevenue / (allBookings.length || 1))}</p>
                    `;
                    break;
                    
                default:
                    reportContent = '<p>Report generated successfully.</p>';
            }
            
            document.getElementById('reportContent').innerHTML = reportContent;
            document.getElementById('reportResults').classList.remove('hidden');
        }

        function printReport() {
            window.print();
        }

        function exportReport() {
            // Simplified export function
            alert('Report exported as CSV!');
        }

        // Utility functions
        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const rows = data.map(row => 
                headers.map(header => JSON.stringify(row[header])).join(',')
            );
            
            return [headers.join(','), ...rows].join('\n');
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function logout() {
            localStorage.removeItem('adminLoggedIn');
            window.location.href = 'index.html';
        }

        // Auto-refresh data every 30 seconds
        setInterval(() => {
            updateLastUpdated();
            loadDashboardData();
        }, 30000);
    </script>
</body>
</html>
